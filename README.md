# Vernon Museum and Archives Exhibit Website

Run 

```
$ yarn run dev
```

to start the development server.

Occasionally, you might see a warning about the number of Prisma Clients running. This is just caused by Next's hot reloading and wont affect the actual website.

## React with NextJS

Use the `Link` component, imported from `next/link` to make relative links to other pages or to external websites.

The `Head` component, imported from `next/head`, is responsible for setting the metadata and can be used just like the `<head>` tag in HTML. The `pages/_document.tsx` component wraps every page before its exported and includes some metadata, but it omits the `<title>` and `<meta name="viewport ...>` tags so that they can be set by individual pages.

If a page file exports a function `getServerSideProps` which matches the type `GetServerSideProps` imported from `next`, that function will be called and it's return value will be used to set the props for the page as its rendered on the server, before being sent to the client.

Since Next automatically turns each file in `pages` that exports a component into an endpoint, React components (that aren't pages) should be kept in `components`, just as `handlers` holds API request handlers.

## Database 

Prisma is used to interact with the database. If you want to interact with the data directly through the CLI, use

```
$ sqlite3 prisma/dev.db
```

If  you want to change the schema of the database, change the `prisma/schema.prisma` file, then run

```
$ yarn run migrate
```

to apply those changes. Note that this command also updates the types and Zod objects generated by Prisma.

## Types and Type Safety

Prisma generates its own types and matching Zod objects for runtime type-checking and parsing.

Custom types are defined in `types`. The types in `types/specialModels.ts` are definitions of types and Zod objects that extend those generated by Prisma. The following are two types that are important for interacting with the database and API:

-   `PopulatedExhibit` which represents an exhibit with its `cards` included. When interacting with the API to receive a database, you can expect it to return with this shape. This type should always be returned by queries like the following:

    ```
    prisma.exhibit.findFirst({ include: { cards: true } });
    ```

-   `PopulatedExhibitCreatable` which is the same as `PopulatedExhibit`, except that it doesn't have any `id` attributes on it. This makes it appropriate to insert into the database while allowing the database to autogenerate the `id`s. When you want to create a new Exhibit, this is the shape that the API will expect you to send as the body.

The last type that the API will frequently use is:

-   `ErrorMessage` which is sent back from the API whenever a request couldn't be processed.

## API Requests

The API endpoints are mapped to the `pages/api` folder by Next. In order to separate the request handlers, they have been moved into `handlers`. If you want to know how a given request is handled, check the corresponding file in `handlers`.

E.g., if you want to know how a GET request to `/api/exhibit` is handled, look at `handlers/exhibit/get.ts`.

I will try to comment the API handlers so that it's clear what they expect/return.